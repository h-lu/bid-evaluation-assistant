# 安全设计规范

> 版本：v3.0
> 日期：2026-02-21
> 架构基线：`docs/plans/2026-02-21-end-to-end-unified-design.md`

---

## 1. 安全目标

1. 防止跨租户数据访问。
2. 保障评标过程可审计、可追溯。
3. 控制密钥与敏感数据泄露风险。
4. 满足留存与合规要求（`legal_hold` + WORM）。

---

## 2. 身份与访问控制

- 认证：JWT（短 access + refresh）。
- 授权：RBAC + 租户边界控制。
- 默认拒绝：最小权限。
- 会话安全：支持令牌撤销、异常会话失效。

角色：`admin`、`agent`、`evaluator`、`viewer`。

---

## 3. 多租户隔离控制

1. 数据库：关键表强制 `tenant_id` + RLS。
2. 向量库：按租户命名空间隔离。
3. 缓存：Redis key 加租户前缀。
4. 任务：`job.tenant_id` 创建后不可变，执行时二次校验。
5. 越界访问统一返回 `403 TENANT_SCOPE_VIOLATION`。

---

## 4. 数据保护

- 传输：TLS 1.2+
- 存储：数据库与备份加密
- 密钥：仅通过密钥管理系统或受控环境变量注入
- 轮换：90 天
- 脱敏：日志屏蔽身份证、手机号、token、密钥

---

## 5. 审计与留存

审计字段最小集合：

- `who`
- `when`
- `what`
- `why`
- `trace_id`

留存策略：

- 审计日志 >= 5 年
- 评估报告 >= 5 年
- `legal_hold` 数据：WORM 不可变存储，禁止删除与覆盖

---

## 6. 高风险动作控制

高风险动作：

- 终审发布
- `DLQ discard`

控制要求：

1. 二次确认。
2. 必须记录操作原因。
3. 操作人和复核人写入审计日志。

---

## 7. 安全发布门禁

1. 未授权访问测试通过（401/403）。
2. 跨租户越权测试通过。
3. 依赖漏洞扫描无阻断级漏洞。
4. 密钥泄露扫描通过。
5. 审计链完整性检查通过。
